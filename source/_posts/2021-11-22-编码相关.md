---
title: 编码相关
date: 2021-11-22 11:28:37
tags:
---

### **js 默认 UTF-16存储**

### 几个API
+ charAt()  
返回字符串中的字符 str.charAt(index)
+ charCodeAt(index)  
返回字符串首字符的Unicode  str.charCodeAt(index)
+ charPointAt(index)  
返回字符串首字符的Unicode  str.charPointAt(index) 
js 默认 UTF-16存储，有些字符码点大于 0x10000，js会识别为两个字符(四字节），如：𠮷（ji），𠮷.length = 2;  
如果某个字符为四字节 charPointAt会返回全部的码点，（具体看文档）  
````
let str = "𠮷"
str.length   3
str.codePointAt(2) 97
````

### 字符集 Unicode 和 编码方式 UTF-8 的关系
+ 字符集只是码点和字符的映射，编码方式是计算机存储字符码点的方式
+ 为什么用编码方式？
  - 一个字符可能用单个字节、多个字节表示，需要标识某个字节是单独一个字符传，还是某个多个字节的一部分
+ 编码方式有编码和解码两个行为，
  - 编码：将某个值通过算法编码
  - 解码：反编码，至计算机可以正确识别字符集的码点。
  - 在编辑器里切换编码方式，导致乱码，是因为通过当前编码方式 解码失败


### utf-8 utf-16 utf-32 

+ utf-8
单字节 或者多字节
0xxxxxxx  
110xxxxx 10xxxxxxx  
1110xxxx 10xxxxxxx 10xxxxxx  
...  
[文档](https://taoshu.in/c-utf-8.html)

+ utf-16
两个字节，或者四个字节表示一个Unicode字符  
如果U（原码点）小于 0x10000, 则不用转换, 原码点即为UTF-16编码。  
如果U 小于等于 0x10ffff,  先U' = U - 0x10000，此时 U' 不会超过20位。可设两个无符号16位的整数W1、W2，将U'分为高十位和低十位，将高十位分分给W1的后十位，将低十位分给W2的后十位，得到两个双字节。
W1 W2前缀 官方定义为 101110xxxxxxxxxx 101111xxxxxxxxxx,即 0xD800 0XDC00,为了防止四字节和双字节的语义冲突，Unicode规定  0xD800-oxD8ff 0xDc00-0xDcff,这两个区域不允许分配字符  [文档](https://blog.csdn.net/xinbaobaoer/article/details/56290210?spm=1001.2101.3001.6650.1&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-1.no_search_link&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-1.no_search_link)

+ utf-32
使用四个字节表示一个unicode字符，浪费资源
