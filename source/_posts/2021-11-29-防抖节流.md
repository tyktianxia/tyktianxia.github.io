---
title: 防抖节流
date: 2021-11-29 13:41:33
tags: JS
---

## 防抖节流

- 防抖

所谓防抖就是连续触发事件但是只有在 n 秒内无事件触发才执行函数，如按钮点击等  
有后执行版和立即执行版实现，常用的是后执行版实现

```
    var timer1 = null;
    var timer2 = null;
    // 后执行
    function fun1() {
      if (timer1) {
        clearTimeout(timer1);
      }
      timer1 = setTimeout(() => {
        console.log("fun1");
        timer1 = null;
      }, 1000);
    }
    // 先执行
    function fun2() {
      if (timer2) {
        clearTimeout(timer2);
      }
      if (!timer2) {
        console.log("fun2");
      }
      timer2 = setTimeout(() => {
        timer2 = null;
      }, 1000);
    }
```

- 节流

所谓节流就是连续触发事件但是在 n 秒钟只触发一次，节流会稀释函数的执行频率。如 滚动条 scroll 事件  
同样，也有后执行和先执行实现  
并且有时间戳和定时器版  

```
    var timer3 = null;
    var timer4 = null;
    function fun3() {
      if (timer3) {
        return;
      }
      timer3 = setTimeout(() => {
        console.log("fun3");
        timer3 = null;
      }, 1000);
    }
    function fun4() {
      if (timer4) {
        return;
      }
      if (!timer4) {
        console.log("fun4");
      }
      timer4 = setTimeout(() => {
        timer4 = null;
      }, 1000);
    }

    // 时间戳
    let previous = 0;
    function fun6(){
      let now = Date.now();
      if(now - previous > 1000){
        console.log('fun6')
        previous = now
      }
    }
```

还可以进行一下包装，通用化

```
    function debounce(func, wait, ...args) {
      let timeout;
      return function () {
        let context = this;

        if (timeout) clearTimeout(timeout);

        let callNow = !timeout;
        timeout = setTimeout(() => {
          timeout = null;
        }, wait);

        if (callNow) func.apply(context, args);
      };
    }
    function test() {
      console.log("test");
    }
    let fun0 = debounce(test, 500);
```


参考资料：  
https://www.jianshu.com/p/c8b86b09daf0